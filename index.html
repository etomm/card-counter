<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conta Carte Hold'em</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b5" />
  <style>
    :root{--bg:#0a0f0a;--fg:#e9f5ee;--muted:#9fb9ad;--accent:#0b5}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif;background:var(--bg);color:var(--fg);}
    header{position:sticky;top:0;background:#0d1410;border-bottom:1px solid #143;padding:.5rem .75rem;z-index:3}
    h1{font-size:1.1rem;margin:.2rem 0}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
    button{background:#132; color:var(--fg); border:1px solid #264; padding:.45rem .7rem; border-radius:.5rem; cursor:pointer}
    button.primary{background:var(--accent);border-color:#0a4;color:#021}
    #grid{padding:.75rem; display:grid; grid-template-columns:repeat(4, minmax(70px, 1fr)); gap:.5rem; align-items:center; justify-items:center}
    .card{width:100%; aspect-ratio:63/88; border-radius:.4rem; border:1px solid #2a2f2a; display:flex; align-items:center; justify-content:center; background:#0e1510; position:relative; overflow:hidden; cursor:pointer; transition:transform .05s}
    .card:active{transform:scale(.98)}
    .card img{width:100%; height:100%; object-fit:contain; padding:4px; display:block; opacity:.98; filter:drop-shadow(0 0 .2rem #000a)}
    .card.removed{opacity:.22; filter:grayscale(.9) brightness(.7)}
    .badge{position:absolute; inset:auto .35rem .35rem auto; background:#0009; color:#fff; font-size:.75rem; padding:.12rem .36rem; border-radius:.35rem}
    .legend{display:flex;gap:1rem; padding:.2rem .75rem; color:var(--muted); font-size:.95rem}
    .status{padding:.4rem .75rem; color:var(--muted)}
    .grid-wrap{max-width:920px; margin:0 auto}
    @media (width >= 900px){ #grid{ grid-template-columns:repeat(4, minmax(110px, 1fr)); } }
  </style>
</head>
<body>
  <header>
    <h1>Conta Carte Hold'em</h1>
    <div class="toolbar">
      <button class="primary" id="reset">Reset</button>
      <button id="inverti">Inverti selezione</button>
      <button id="soloVive">Mostra solo vive</button>
      <button id="soloMorte">Mostra solo morte</button>
      <button id="tutte">Mostra tutte</button>
      <button id="toggleLayout">Layout compatto 13×4</button>
    </div>
    <div class="legend"> 
      <span>Vive: <strong id="count-live">52</strong></span>
      <span>Morte: <strong id="count-dead">0</strong></span>
    </div>
  </header>
  <div class="grid-wrap">
    <div id="grid" aria-label="Mazzo di 52 carte (righe per rango, 4 colonne per semi)"></div>
    <div class="status" id="status"></div>
  </div>
  <script>
  const ranks = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];
  const suits = ['S','H','D','C']; // Spade, Hearts, Diamonds, Clubs
  const suitNames = {S:'picche', H:'cuori', D:'quadri', C:'fiori'};

  function suitGlyph(s){ switch(s){ case 'S': return '♠'; case 'H': return '♥'; case 'D': return '♦'; case 'C': return '♣'; } }
  function isRed(s){ return (s==='H'||s==='D'); }
  function inkColor(s){ return isRed(s) ? '#e44747' : '#eaf3ea'; }

  function pip(x, y, s, fontSize, rotate){
    const glyph = suitGlyph(s);
    const rot = rotate ? ` transform='rotate(180 ${x} ${y})'` : '';
    return `<text x='${x}' y='${y}' font-size='${fontSize}' text-anchor='middle' dominant-baseline='middle'${rot}>${glyph}</text>`;
  }

  function cornerIndex(rank, s){
    const c = inkColor(s);
    return `
      <g fill='${c}' font-family='-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif' font-weight='700'>
        <text x='48' y='120' font-size='92'>${rank}</text>
        <text x='48' y='190' font-size='92'>${suitGlyph(s)}</text>
        <g transform='rotate(180 582 820)'>
          <text x='582' y='820' font-size='92' text-anchor='end'>${rank}</text>
          <text x='582' y='750' font-size='92' text-anchor='end'>${suitGlyph(s)}</text>
        </g>
      </g>`;
  }

  function pipsForRank(rank, suit){
    const c = inkColor(suit);
    const X = {L:150, CL:240, C:315, CR:390, R:480};
    const Y = {T:160, UT:270, M:440, DB:610, B:720};

    let content = `<g fill='${c}' font-family='-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif' font-weight='700'>`;
    const num = (rank==='A')?1 : (rank==='K'||rank==='Q'||rank==='J'?null : (rank==='10'?10:parseInt(rank)));

    if(rank==='A'){
      content += pip(315, 440, suit, 260, false);
    } else if(num){
      const fs = 120;
      switch(num){
        case 2: content += pip(X.C, Y.T, suit, fs, false) + pip(X.C, Y.B, suit, fs, true); break;
        case 3: content += pip(X.C, Y.T, suit, fs, false) + pip(X.C, Y.M, suit, fs, false) + pip(X.C, Y.B, suit, fs, true); break;
        case 4: content += pip(X.L, Y.T, suit, fs, false) + pip(X.R, Y.T, suit, fs, false) + pip(X.L, Y.B, suit, fs, true) + pip(X.R, Y.B, suit, fs, true); break;
        case 5: content += pip(X.L, Y.T, suit, fs, false) + pip(X.R, Y.T, suit, fs, false) + pip(X.C, Y.M, suit, fs, false) + pip(X.L, Y.B, suit, fs, true) + pip(X.R, Y.B, suit, fs, true); break;
        case 6: content += pip(X.L, Y.T, suit, fs, false) + pip(X.R, Y.T, suit, fs, false) + pip(X.L, Y.M, suit, fs, false) + pip(X.R, Y.M, suit, fs, false) + pip(X.L, Y.B, suit, fs, true) + pip(X.R, Y.B, suit, fs, true); break;
        case 7: content += pip(X.C, Y.T, suit, fs, false) + pip(X.L, Y.UT, suit, fs, false) + pip(X.R, Y.UT, suit, fs, false) + pip(X.L, Y.M, suit, fs, false) + pip(X.R, Y.M, suit, fs, false) + pip(X.L, Y.B, suit, fs, true) + pip(X.R, Y.B, suit, fs, true); break;
        case 8: content += pip(X.C, Y.T, suit, fs, false) + pip(X.L, Y.UT, suit, fs, false) + pip(X.R, Y.UT, suit, fs, false) + pip(X.L, Y.M, suit, fs, false) + pip(X.R, Y.M, suit, fs, false) + pip(X.L, Y.DB, suit, fs, true) + pip(X.R, Y.DB, suit, fs, true) + pip(X.C, Y.B, suit, fs, true); break;
        case 9: content += pip(X.C, Y.M, suit, fs, false) + pip(X.C, Y.T, suit, fs, false) + pip(X.C, Y.B, suit, fs, true) + pip(X.L, Y.UT, suit, fs, false) + pip(X.R, Y.UT, suit, fs, false) + pip(X.L, Y.DB, suit, fs, true) + pip(X.R, Y.DB, suit, fs, true) + pip(X.L, Y.M, suit, fs, false) + pip(X.R, Y.M, suit, fs, false); break;
        case 10: content += pip(X.L, Y.T, suit, fs, false) + pip(X.R, Y.T, suit, fs, false) + pip(X.L, Y.UT, suit, fs, false) + pip(X.R, Y.UT, suit, fs, false) + pip(X.L, Y.M, suit, fs, false) + pip(X.R, Y.M, suit, fs, false) + pip(X.L, Y.DB, suit, fs, true) + pip(X.R, Y.DB, suit, fs, true) + pip(X.L, Y.B, suit, fs, true) + pip(X.R, Y.B, suit, fs, true); break;
      }
    } else {
      const glyph = suitGlyph(suit);
      content += `<text x='315' y='420' font-size='260' text-anchor='middle' dominant-baseline='middle' opacity='0.95'>${rank}</text>`;
      content += `<text x='315' y='620' font-size='160' text-anchor='middle' dominant-baseline='middle' opacity='0.9'>${glyph}</text>`;
    }

    content += '</g>'; return content;
  }

  function cardSVG(rank,suit){
    const bgStroke = isRed(suit)?'#a44':'#2a3';
    return `data:image/svg+xml;utf8,`+
      encodeURIComponent(`
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 630 880' preserveAspectRatio='xMidYMid meet'>
        <defs>
          <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0' stop-color='#0f1a12'/>
            <stop offset='1' stop-color='#0a120c'/>
          </linearGradient>
        </defs>
        <rect x='8' y='8' width='614' height='864' rx='36' ry='36' fill='url(#g)' stroke='${bgStroke}' stroke-width='8'/>
        ${cornerIndex(rank, suit)}
        ${pipsForRank(rank, suit)}
      </svg>`);
  }

  const deck = []; // rows by rank, 4 columns by suit
  for(const r of ranks){ for(const s of suits){ deck.push({id:`${r}${s}`, r, s}); } }

  const grid = document.getElementById('grid');
  const stateKey = 'holdem-card-state-v3';
  let removed = new Set(JSON.parse(localStorage.getItem(stateKey) || '[]'));
  let compact = false;

  function render(){
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = compact ? 'repeat(13, minmax(24px, 1fr))' : 'repeat(4, minmax(70px, 1fr))';
    for(const card of deck){
      const el = document.createElement('button'); el.className = 'card'; el.type = 'button';
      const img = document.createElement('img');
      img.alt = `${card.r} di ${suitNames[card.s]}`; img.loading = 'lazy'; img.decoding = 'async';
      img.src = cardSVG(card.r, card.s); el.appendChild(img);
      if(removed.has(card.id)) el.classList.add('removed');
      const badge = document.createElement('span'); badge.className = 'badge'; badge.textContent = removed.has(card.id) ? 'morta' : 'viva'; el.appendChild(badge);
      el.addEventListener('click', ()=>{ if(removed.has(card.id)) removed.delete(card.id); else removed.add(card.id); save(); updateCounts(); el.classList.toggle('removed'); badge.textContent = removed.has(card.id) ? 'morta' : 'viva'; });
      grid.appendChild(el);
    }
  }

  function save(){ localStorage.setItem(stateKey, JSON.stringify([...removed])); }
  function updateCounts(){ const dead = removed.size; const live = 52 - dead; document.getElementById('count-live').textContent = String(live); document.getElementById('count-dead').textContent = String(dead); }

  document.getElementById('reset').onclick = ()=>{ removed = new Set(); save(); updateCounts(); render(); };
  document.getElementById('inverti').onclick = ()=>{ const newSet = new Set(); for(const c of deck){ if(!removed.has(c.id)) newSet.add(c.id); } removed = newSet; save(); updateCounts(); render(); };
  document.getElementById('soloVive').onclick = ()=>{ document.querySelectorAll('.card').forEach(el=>{ el.style.display = el.classList.contains('removed') ? 'none' : ''; }); };
  document.getElementById('soloMorte').onclick = ()=>{ document.querySelectorAll('.card').forEach(el=>{ el.style.display = !el.classList.contains('removed') ? 'none' : ''; }); };
  document.getElementById('tutte').onclick = ()=>{ document.querySelectorAll('.card').forEach(el=>{ el.style.display=''; }); };
  document.getElementById('toggleLayout').onclick = ()=>{ compact = !compact; document.getElementById('toggleLayout').textContent = compact? 'Layout grande 4×13' : 'Layout compatto 13×4'; render(); };

  render(); updateCounts();

  if('serviceWorker' in navigator){ window.addEventListener('load', ()=>{ navigator.serviceWorker.register('sw.js'); }); }
  </script>
</body>
</html>