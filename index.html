<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conta Carte Hold'em</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b5" />
  <style>
    :root{--bg:#0a0f0a;--fg:#e9f5ee;--muted:#9fb9ad;--accent:#0b5}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif;background:var(--bg);color:var(--fg);}
    header{position:sticky;top:0;background:#0d1410;border-bottom:1px solid #143;padding:.5rem .75rem;z-index:3}
    h1{font-size:1.1rem;margin:.2rem 0}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
    button{background:#132; color:var(--fg); border:1px solid #264; padding:.45rem .7rem; border-radius:.5rem; cursor:pointer}
    button.primary{background:var(--accent);border-color:#0a4;color:#021}
    button.danger{background:#743;border-color:#a64}
    #grid{padding:.75rem; display:grid; grid-template-columns:repeat(13, minmax(34px, 1fr)); gap:.35rem; align-items:center; justify-items:center}    
    .card{width:100%; aspect-ratio:63/88; border-radius:.35rem; border:1px solid #2a2f2a; display:flex; align-items:center; justify-content:center; background:#0e1510; position:relative; overflow:hidden; cursor:pointer; transition:transform .05s}
    .card:active{transform:scale(.98)}
    .card img{width:100%; height:100%; object-fit:contain; padding: 2px; display:block; opacity:.96; filter:drop-shadow(0 0 .2rem #000a)}
    .card.removed{opacity:.22; filter:grayscale(.9) brightness(.7)}
    .badge{position:absolute; inset:auto .25rem .25rem auto; background:#0009; color:#fff; font-size:.7rem; padding:.1rem .3rem; border-radius:.3rem}
    .legend{display:flex;gap:1rem; padding:.2rem .75rem; color:var(--muted); font-size:.9rem}
    .status{padding:.4rem .75rem; color:var(--muted)}
    .grid-wrap{max-width:980px; margin:0 auto}
    @media (max-width:680px){ #grid{grid-template-columns:repeat(13, minmax(24px, 1fr)); gap:.25rem} }
  </style>
</head>
<body>
  <header>
    <h1>Conta Carte Hold'em</h1>
    <div class="toolbar">
      <button class="primary" id="reset">Reset</button>
      <button id="inverti">Inverti selezione</button>
      <button id="soloVive">Mostra solo vive</button>
      <button id="soloMorte">Mostra solo morte</button>
      <button id="tutte">Mostra tutte</button>
    </div>
    <div class="legend"> 
      <span>Vive: <strong id="count-live">52</strong></span>
      <span>Morte: <strong id="count-dead">0</strong></span>
    </div>
  </header>
  <div class="grid-wrap">
    <div id="grid" aria-label="Mazzo di 52 carte"></div>
    <div class="status" id="status"></div>
  </div>
  <script>
  const ranks = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];
  const suits = ['S','H','D','C']; // Spade, Hearts, Diamonds, Clubs
  const suitNames = {S:'picche', H:'cuori', D:'quadri', C:'fiori'};

  function suitGlyph(s){
    switch(s){
      case 'S': return '♠';
      case 'H': return '♥';
      case 'D': return '♦';
      case 'C': return '♣';
    }
  }
  function suitColor(s){
    return (s==='H'||s==='D') ? '#e44747' : '#eaf3ea';
  }
  function cardSVG(rank,suit){
    const color = suitColor(suit);
    const glyph = suitGlyph(suit);
    const rtxt = rank;
    return `data:image/svg+xml;utf8,`+
      encodeURIComponent(`
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 630 880' preserveAspectRatio='xMidYMid meet'>
        <defs>
          <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0' stop-color='#0f1a12'/>
            <stop offset='1' stop-color='#0a120c'/>
          </linearGradient>
        </defs>
        <rect x='8' y='8' width='614' height='864' rx='36' ry='36' fill='url(#g)' stroke='#2a3' stroke-width='8'/>
        <g font-family='-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif' font-weight='700' fill='${color}'>
          <text x='40' y='110' font-size='100'>${rtxt}</text>
          <text x='40' y='200' font-size='100'>${glyph}</text>
          <text x='590' y='820' font-size='100' text-anchor='end' transform='rotate(180 590 820)'>${rtxt}</text>
          <text x='590' y='730' font-size='100' text-anchor='end' transform='rotate(180 590 820)'>${glyph}</text>
          <text x='315' y='460' font-size='260' text-anchor='middle' dominant-baseline='middle' opacity='0.9'>${glyph}</text>
        </g>
      </svg>`);
  }

  const deck = [];
  for(const r of ranks){
    for(const s of suits){
      deck.push({id:`${r}${s}`, r, s});
    }
  }

  const grid = document.getElementById('grid');
  const stateKey = 'holdem-card-state-v1';
  let removed = new Set(JSON.parse(localStorage.getItem(stateKey) || '[]'));

  function render(){
    grid.innerHTML = '';
    for(const card of deck){
      const el = document.createElement('button');
      el.className = 'card';
      el.type = 'button';
      const img = document.createElement('img');
      img.alt = `${card.r} di ${suitNames[card.s]}`;
      img.loading = 'lazy';
      img.decoding = 'async';
      img.src = cardSVG(card.r, card.s);
      el.appendChild(img);
      if(removed.has(card.id)) el.classList.add('removed');
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.textContent = removed.has(card.id) ? 'morta' : 'viva';
      el.appendChild(badge);
      el.addEventListener('click', ()=>{
        if(removed.has(card.id)) removed.delete(card.id); else removed.add(card.id);
        save();
        updateCounts();
        el.classList.toggle('removed');
        badge.textContent = removed.has(card.id) ? 'morta' : 'viva';
      });
      grid.appendChild(el);
    }
  }

  function save(){
    localStorage.setItem(stateKey, JSON.stringify([...removed]));
  }

  function updateCounts(){
    const dead = removed.size;
    const live = 52 - dead;
    document.getElementById('count-live').textContent = String(live);
    document.getElementById('count-dead').textContent = String(dead);
  }

  document.getElementById('reset').onclick = ()=>{ removed = new Set(); save(); updateCounts(); render(); };
  document.getElementById('inverti').onclick = ()=>{
    const newSet = new Set();
    for(const c of deck){ if(!removed.has(c.id)) newSet.add(c.id); }
    removed = newSet; save(); updateCounts(); render();
  };
  document.getElementById('soloVive').onclick = ()=>{
    document.querySelectorAll('.card').forEach(el=>{
      if(el.classList.contains('removed')) el.style.display='none'; else el.style.display='';
    });
  };
  document.getElementById('soloMorte').onclick = ()=>{
    document.querySelectorAll('.card').forEach(el=>{
      if(!el.classList.contains('removed')) el.style.display='none'; else el.style.display='';
    });
  };
  document.getElementById('tutte').onclick = ()=>{
    document.querySelectorAll('.card').forEach(el=>{ el.style.display=''; });
  };

  render();
  updateCounts();

  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=>{
      navigator.serviceWorker.register('sw.js');
    });
  }
  </script>
</body>
</html>
